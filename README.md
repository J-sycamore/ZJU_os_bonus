use hash to replace memory

**still exist bug**
